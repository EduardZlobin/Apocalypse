<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Apocalypse â€” Flame</title>

  <style>
    body{
      margin:0;
      font-family:system-ui;
      background:#070812;
      color:white;
      display:flex;
      justify-content:center;
      align-items:center;
      height:100vh;
      flex-direction:column;
      gap:20px;
    }
    button{
      padding:12px 20px;
      border-radius:10px;
      border:none;
      cursor:pointer;
      font-size:16px;
    }
  </style>
</head>

<body>

<h1>ðŸ”¥ Apocalypse Flame</h1>

<button id="login">Ð’Ð¾Ð¹Ñ‚Ð¸ Ñ‡ÐµÑ€ÐµÐ· Discord</button>
<button id="logout" style="display:none;">Ð’Ñ‹Ð¹Ñ‚Ð¸</button>

<div id="status">Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ°...</div>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";

const SUPABASE_URL = "https://vskoiojbedimfdatepqy.supabase.co";
const SUPABASE_KEY = "sb_publishable_VcqtTyBpAwlpJuwh_Wc0tw_IPxVIsgP";
const SITE_URL = "https://eduardzlobin.github.io/Apocalypse";

const sb = createClient(SUPABASE_URL, SUPABASE_KEY);

const loginBtn = document.getElementById("login");
const logoutBtn = document.getElementById("logout");
const status = document.getElementById("status");

function setStatus(t){ status.textContent = t }

loginBtn.onclick = async ()=>{
  setStatus("ÐžÑ‚ÐºÑ€Ñ‹Ð²Ð°ÑŽ Discord...");
  const { error } = await sb.auth.signInWithOAuth({
    provider:"discord",
    options:{ redirectTo:SITE_URL }
  });
  if(error){
    console.error(error);
    setStatus("ÐžÑˆÐ¸Ð±ÐºÐ° Ð»Ð¾Ð³Ð¸Ð½Ð°");
  }
};

logoutBtn.onclick = async ()=>{
  await sb.auth.signOut();
  location.reload();
};

const { data } = await sb.auth.getSession();

if(data.session){
  setStatus("Ð¢Ñ‹ Ð·Ð°Ð»Ð¾Ð³Ð¸Ð½ÐµÐ½");
  loginBtn.style.display="none";
  logoutBtn.style.display="block";
}else{
  setStatus("ÐÐµ Ð·Ð°Ð»Ð¾Ð³Ð¸Ð½ÐµÐ½");
}

sb.auth.onAuthStateChange((_e,session)=>{
  if(session){
    loginBtn.style.display="none";
    logoutBtn.style.display="block";
    setStatus("Ð¢Ñ‹ Ð·Ð°Ð»Ð¾Ð³Ð¸Ð½ÐµÐ½");
  }
});
</script>

</body>
</html>
